<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>SSE 테스트</title>
</head>
<body>
<h2>조직별 SSE 테스트</h2>
<label>Org ID: <input id="orgId" value="org1"></label>
<button id="connect">연결</button>
<ul id="events"></ul>

<script>
    let es;
    document.getElementById('connect').onclick = () => {
      const orgId = document.getElementById('orgId').value;
      // 이미 연결돼 있으면 닫고 새로 연결
      if (es) es.close();
      document.getElementById('events').innerHTML = '';
      // 1) /api/stream?orgId=xxx 로 SSE 연결
      es = new EventSource('/api/stream?orgId=' + encodeURIComponent(orgId));
      es.onopen = () => console.log('SSE open for', orgId);
      es.onerror = err => console.error('SSE error', err);
      // 2) kafka-event 이벤트 리스너 등록
      es.addEventListener('kafka-event', e => {
        const li = document.createElement('li');
        li.textContent = `[${orgId}] ${e.data}`;
        document.getElementById('events').appendChild(li);
      });
    };
</script>
</body>
</html>
