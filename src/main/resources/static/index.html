<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>SSE 테스트</title>
</head>
<body>
<h2>조직별 SSE 테스트</h2>
<label>Org ID: <input id="orgId" value="org1"></label>
<button id="connect">연결</button>
<ul id="events"></ul>

<script>
    let es = null;
    document.getElementById('connect').onclick = () => {
        const orgId = document.getElementById('orgId').value;
        // 이미 연결이 열려 있으면 재연결하지 않음
        if (es && es.readyState === EventSource.OPEN) {
            console.log('이미 연결되어 있습니다:', orgId);
            return;
        }
        // 기존 연결이 있으면 닫기
        if (es) {
            es.close();
            es = null;
        }
        document.getElementById('events').innerHTML = '';
        // SSE 연결 생성
        es = new EventSource('/api/stream?orgId=' + encodeURIComponent(orgId));
        es.onopen = () => console.log('SSE open for', orgId);
        es.onerror = err => console.error('SSE error', err);
        es.addEventListener('kafka-event', e => {
            const li = document.createElement('li');
            li.textContent = `[${orgId}] ${e.data}`;
            document.getElementById('events').appendChild(li);
        });
    };
</script>
</body>
</html>